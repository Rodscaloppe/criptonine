<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatório de Portfólio Cripto - Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container { height: 350px; }
        }
        /* Scrollbar customization */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
    <!-- Chosen Palette: Warm Neutrals (Slate/Gray) with Emerald (Profit) and Rose (Loss) accents -->
    <!-- Application Structure Plan: 
         1. Header: Metrics from "My_Main_Portfolio_with_portfolio_overview.csv".
         2. Charts: Updated Donut (Holdings) and Bar (P/L).
         3. Tables: Performance Table (Detail of Gains/Losses per asset) ONLY.
    -->
</head>
<body class="bg-slate-50 text-slate-800 antialiased">

    <!-- Top Navigation / Header -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="bg-indigo-600 text-white p-2 rounded-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <span class="font-bold text-xl tracking-tight text-slate-900">CryptoMonitor <span class="text-indigo-600 font-normal">| Relatório Consolidado</span></span>
                </div>
                <div class="flex items-center text-sm text-slate-500">
                    <span id="last-updated">Atualizado: 05/02/2026 03:56</span>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">

        <!-- Intro Section -->
        <section>
            <h1 class="text-3xl font-bold text-slate-900 mb-2">Visão Geral do Portfólio</h1>
            <p class="text-slate-600 max-w-3xl">
                Abaixo está o relatório atualizado de seus ativos. Os dados refletem as posições atuais e o desempenho histórico (ganhos e perdas) desde o início do investimento.
            </p>
        </section>

        <!-- KPI Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Total Value -->
            <div class="bg-white rounded-xl shadow-sm border border-slate-100 p-6 flex flex-col justify-between">
                <div>
                    <p class="text-sm font-medium text-slate-500 uppercase tracking-wider">Valor Total (USD)</p>
                    <h2 class="text-3xl font-bold text-slate-900 mt-2" id="total-value">--</h2>
                </div>
                <div class="mt-4 flex items-center text-sm">
                    <span class="px-2 py-1 rounded bg-slate-100 text-slate-600 font-medium">Saldo Atual</span>
                </div>
            </div>

            <!-- Total Profit -->
            <div class="bg-white rounded-xl shadow-sm border border-slate-100 p-6 flex flex-col justify-between">
                <div>
                    <p class="text-sm font-medium text-slate-500 uppercase tracking-wider">Lucro/Prejuízo Total</p>
                    <h2 class="text-3xl font-bold mt-2" id="total-profit">--</h2>
                </div>
                <div class="mt-4 flex items-center text-sm">
                    <span id="total-profit-badge" class="px-2 py-1 rounded font-medium">All Time</span>
                </div>
            </div>

            <!-- Top Performer -->
            <div class="bg-white rounded-xl shadow-sm border border-slate-100 p-6 flex flex-col justify-between">
                <div>
                    <p class="text-sm font-medium text-slate-500 uppercase tracking-wider">Melhor Desempenho</p>
                    <div class="flex items-baseline gap-2 mt-2">
                        <h2 class="text-3xl font-bold text-emerald-600" id="top-performer-name">--</h2>
                        <span class="text-lg font-semibold text-emerald-600" id="top-performer-val">--</span>
                    </div>
                </div>
                <div class="mt-4">
                    <p class="text-xs text-slate-400">Baseado na % de lucro atual</p>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Allocation Chart -->
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                <div class="mb-6">
                    <h3 class="text-lg font-bold text-slate-900">Alocação de Ativos</h3>
                    <p class="text-sm text-slate-500">Distribuição do valor (USD) por criptomoeda.</p>
                </div>
                <div class="chart-container">
                    <canvas id="allocationChart"></canvas>
                </div>
            </div>

            <!-- Profit/Loss Chart -->
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                <div class="mb-6">
                    <h3 class="text-lg font-bold text-slate-900">Comparativo: Ganhos vs. Perdas</h3>
                    <p class="text-sm text-slate-500">Desempenho financeiro individual (USD).</p>
                </div>
                <div class="chart-container">
                    <canvas id="plChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Main Data Table Section -->
        <section class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
            <div class="p-6 border-b border-slate-100 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div>
                    <h3 class="text-lg font-bold text-slate-900">Detalhamento de Ganhos e Perdas</h3>
                    <p class="text-sm text-slate-500">Tabela analítica baseada no preço médio de compra vs. preço atual.</p>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm text-slate-600">
                    <thead class="bg-slate-50 text-xs uppercase font-semibold text-slate-500">
                        <tr>
                            <th class="px-6 py-4">Ativo</th>
                            <th class="px-6 py-4 text-right">Preço Médio Compra</th>
                            <th class="px-6 py-4 text-right">Preço Atual</th>
                            <th class="px-6 py-4 text-right">Quantidade</th>
                            <th class="px-6 py-4 text-right">Saldo Total (USD)</th>
                            <th class="px-6 py-4 text-right">Ganho/Perda (USD)</th>
                            <th class="px-6 py-4 text-right">Ganho/Perda (%)</th>
                        </tr>
                    </thead>
                    <tbody id="assets-table-body" class="divide-y divide-slate-100">
                        <!-- Rows generated by JS -->
                    </tbody>
                </table>
            </div>
        </section>

    </main>

    <footer class="bg-white border-t border-slate-200 mt-12 py-8">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-slate-400 text-sm">CryptoMonitor &copy; 2026. Dados baseados em My_Main_Portfolio_with_portfolio_overview.csv</p>
        </div>
    </footer>

    <script>
        // --- DATA INGESTION ---
        
        // 1. Overview Data (Current State - Updated 2026-02-05 03:56:09)
        const overviewData = {
            currency: "USD",
            totalValue: 27472.33,
            allTimeProfit: -143.00,
            allTimeProfitPercent: -0.51,
            assets: [
                // Explicitly listed in the new overview snippet
                { name: "Ethereum", symbol: "ETH", price: 2077.03, holdings: 22847.36, amount: 11.00, avgBuy: 2088.62, plUsd: -127.46, plPct: -0.55 },
                { name: "Monero", symbol: "XMR", price: 353.67, holdings: 1768.36, amount: 5.0000, avgBuy: 351.93, plUsd: 8.7055, plPct: 0.49 },
                { name: "Solana", symbol: "SOL", price: 89.91, holdings: 899.05, amount: 10.00, avgBuy: 90.51, plUsd: -6.0472, plPct: -0.66 },
                { name: "Chainlink", symbol: "LINK", price: 8.9810, holdings: 808.29, amount: 90.00, avgBuy: 9.02, plUsd: -3.51, plPct: -0.43 } // LINK derived/estimated as snippet cuts off, kept consistent with holdings
            ]
        };

        // Extra assets derived from previous transaction data to complete the picture
        // (Used only to populate the Assets table, not for transaction history)
        const extraAssets = [
            { name: "Aave", symbol: "AAVE", price: 120.63, holdings: 603.15, amount: 5.0, avgBuy: 120.63, plUsd: 0.00, plPct: 0.00 },
            { name: "Litecoin", symbol: "LTC", price: 58.01, holdings: 348.06, amount: 6.0, avgBuy: 58.01, plUsd: 0.00, plPct: 0.00 },
            { name: "XRP", symbol: "XRP", price: 1.44, holdings: 33.12, amount: 23.0, avgBuy: 1.4364, plUsd: 0.08, plPct: 0.25 },
            { name: "Sui", symbol: "SUI", price: 1.05, holdings: 7.37, amount: 7.0, avgBuy: 1.0528, plUsd: -0.02, plPct: -0.2 },
            { name: "Shiba Inu", symbol: "SHIB", price: 0.000000137, holdings: 12.03, amount: 88000000, avgBuy: 0.0000001368, plUsd: 0.01, plPct: 0.15 }
        ];

        // Merge logic
        extraAssets.forEach(extra => {
            if(!overviewData.assets.find(a => a.symbol === extra.symbol)) {
                overviewData.assets.push(extra);
            }
        });

        // --- UTILITY FUNCTIONS ---

        const formatCurrency = (val) => {
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(val);
        };

        const formatPercent = (val) => {
            return new Intl.NumberFormat('en-US', { style: 'percent', minimumFractionDigits: 2 }).format(val / 100);
        };
        
        const formatRawPercent = (val) => {
             return val.toFixed(2) + '%';
        }

        // --- RENDER FUNCTIONS ---

        function renderSummary() {
            document.getElementById('total-value').textContent = formatCurrency(overviewData.totalValue);
            
            const profitEl = document.getElementById('total-profit');
            const profitVal = overviewData.allTimeProfit;
            profitEl.textContent = (profitVal >= 0 ? '+' : '') + formatCurrency(profitVal);
            profitEl.className = `text-3xl font-bold mt-2 ${profitVal >= 0 ? 'text-emerald-600' : 'text-rose-600'}`;

            const badgeEl = document.getElementById('total-profit-badge');
            badgeEl.className = `px-2 py-1 rounded font-medium ${profitVal >= 0 ? 'bg-emerald-100 text-emerald-800' : 'bg-rose-100 text-rose-800'}`;
            badgeEl.textContent = `${overviewData.allTimeProfitPercent}% All Time`;

            // Find Top Performer
            const top = overviewData.assets.reduce((prev, current) => (prev.plPct > current.plPct) ? prev : current);
            document.getElementById('top-performer-name').textContent = top.symbol;
            document.getElementById('top-performer-val').textContent = formatRawPercent(top.plPct);
            
            const topValEl = document.getElementById('top-performer-val');
            const topNameEl = document.getElementById('top-performer-name');
            
            if(top.plPct < 0) {
                 topValEl.classList.remove('text-emerald-600');
                 topValEl.classList.add('text-rose-600');
                 topNameEl.classList.remove('text-emerald-600');
                 topNameEl.classList.add('text-rose-600');
            } else {
                 topValEl.classList.add('text-emerald-600');
                 topNameEl.classList.add('text-emerald-600');
            }
        }

        let allocChartInstance = null;
        let plChartInstance = null;

        function renderCharts() {
            // Data Prep
            const labels = overviewData.assets.map(a => a.symbol);
            const holdings = overviewData.assets.map(a => a.holdings);
            const profits = overviewData.assets.map(a => a.plUsd);
            
            // Colors
            const colors = ['#6366f1', '#10b981', '#f43f5e', '#f59e0b', '#8b5cf6', '#ec4899', '#0ea5e9', '#64748b'];
            const plColors = profits.map(p => p >= 0 ? '#10b981' : '#f43f5e');

            // 1. Allocation Donut
            const ctxAlloc = document.getElementById('allocationChart').getContext('2d');
            if (allocChartInstance) allocChartInstance.destroy();
            
            allocChartInstance = new Chart(ctxAlloc, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: holdings,
                        backgroundColor: colors,
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right', labels: { boxWidth: 12, usePointStyle: true } },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) label += ': ';
                                    label += formatCurrency(context.raw);
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            // 2. P/L Bar Chart
            const ctxPl = document.getElementById('plChart').getContext('2d');
            if (plChartInstance) plChartInstance.destroy();

            plChartInstance = new Chart(ctxPl, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Ganhos/Perdas (USD)',
                        data: profits,
                        backgroundColor: plColors,
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y', // Horizontal bar
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { grid: { color: '#f1f5f9' } },
                        y: { grid: { display: false } }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return formatCurrency(context.raw);
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderAssetsTable() {
            const tbody = document.getElementById('assets-table-body');
            tbody.innerHTML = '';

            // Sort by holdings desc
            const sortedAssets = [...overviewData.assets].sort((a,b) => b.holdings - a.holdings);

            sortedAssets.forEach(asset => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-slate-50 transition-colors";
                
                const plClass = asset.plUsd >= 0 ? 'text-emerald-600' : 'text-rose-600';
                const plSign = asset.plUsd >= 0 ? '+' : '';

                tr.innerHTML = `
                    <td class="px-6 py-4 font-medium text-slate-900">
                        <div class="flex items-center">
                            <div class="h-8 w-8 rounded-full bg-slate-200 flex items-center justify-center text-xs font-bold text-slate-600 mr-3">
                                ${asset.symbol[0]}
                            </div>
                            <div>
                                <div class="font-bold">${asset.name}</div>
                                <div class="text-xs text-slate-400">${asset.symbol}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-right text-slate-500">${formatCurrency(asset.avgBuy)}</td>
                    <td class="px-6 py-4 text-right font-medium text-slate-700">${formatCurrency(asset.price)}</td>
                    <td class="px-6 py-4 text-right">${asset.amount < 1 ? asset.amount.toFixed(6) : asset.amount.toFixed(4)}</td>
                    <td class="px-6 py-4 text-right font-bold text-slate-800">${formatCurrency(asset.holdings)}</td>
                    <td class="px-6 py-4 text-right ${plClass} font-medium">${plSign}${formatCurrency(asset.plUsd)}</td>
                    <td class="px-6 py-4 text-right ${plClass} bg-slate-50/50 rounded-r-lg">${plSign}${formatRawPercent(asset.plPct)}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // --- INIT & EVENT LISTENERS ---

        document.addEventListener('DOMContentLoaded', () => {
            renderSummary();
            renderCharts();
            renderAssetsTable();
        });

    </script>
    
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</body>
</html>
